# Документация к сервису для обработки транзакций
> Автор решения: Махмутов Адель Наилевич  
telegram: @Vodypep
## Описание
Сервис обрабатывает финансовые транзакции, выполняя различные операции в зависимости от типа и статуса транзакции. Основные задачи:

* Обработка транзакций в многопоточном режиме.
* Поддержка различных стратегий для разных типов транзакций.
* Хранение и обновление информации о транзакциях в репозитории.
* Обработка ошибок и логирование при возникновении исключительных ситуаций.
* Приложение состоит из сервисов и стратегий, предназначенных для обработки транзакций с различными статусами (PENDING, PROCESSED, COMPLETED, FAILED) и типами.

## Структура проекта
### Основные компоненты
* __TransactionProcessingService__ — основной сервис, запускающий обработку списка транзакций.
* __TransactionProcessor__ — сервис, выполняющий обработку транзакций в зависимости от их статуса и типа.
* __TransactionProcessorStrategy__ — стратегии для обработки различных типов транзакций.
* __TransactionTypeResolver__ — служба, определяющая тип транзакции для выбора нужной стратегии.
* __TransactionService__ — сервис для взаимодействия с репозиторием транзакций.
* __TransactionRepository__ — интерфейс репозитория, реализованный при помощи структуры данных ConcurrentHashMap.

## Многопоточная обработка
Для многопоточной обработки транзакций используется ExecutorService, что позволяет эффективно управлять потоками и избегать утечек памяти.  
В качестве очереди в реализации используется ArrayBlockingQueue для ограничения числа обрабатываемых задач.

## Используемые технологии
Все используемые библиотеки находятся в файле [libs.versions.toml](gradle/libs.versions.toml).  

## Конфигурация
Файл [application.yaml](src/main/resources/application.yaml) является конфигурационным файлом, содержащий параметры для управления обработкой транзакций.  
Конфигурация для пула потоков, отвечающего за многопоточную обработку транзакций.  
    __queue_size__: Максимальный размер очереди задач (1000), что позволяет удерживать большое количество ожидающих транзакций.  
    __thread_pool_size__: Количество потоков в пуле (100), обеспечивающее параллельную обработку множества транзакций.  
    __keep_alive_time__: Время (60 секунд), в течение которого неиспользуемые потоки остаются активными, прежде чем будут завершены, что помогает оптимизировать использование ресурсов.  
  
Конфигурация для определения классификации транзакций по размеру суммы.  
    __large_threshold__: Порог для больших транзакций (10000), выше которого транзакция считается большой.  
    __medium_threshold__: Порог для средних транзакций (1000), для транзакций, суммы которых находятся между малыми и большими.  
    __small_threshold__: Порог для малых транзакций (0), ниже которого транзакция считается малой.  

## Поток обработки
Транзакция проходит через следующие этапы:  
1. Проверка статуса:  
    * Если статус __FAILED__, __PROCESSED__ транзакция пропускается.  
    * Если статус __PENDING__, проверяется, была ли транзакция уже обработана. Выбирается соответствующая стратегия обработки в зависимости от типа.
    * Если статус __COMPLETED__, транзакция считается завершённой и удаляется из репозитория во избежания переполнения памяти.  
2. При успешной обработке транзакция сохраняется с обновленным статусом.
3. В случае ошибки транзакция сохраняется со статусом __FAILED__.

## Тестирование
Были написаны Unit-тесты и интеграционные тесты, проверяющие работу сервиса и всех компонент вместе.